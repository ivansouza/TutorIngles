<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tutor Completo</title>
    
    <!-- React e Bibliotecas -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body, html { height: 100%; margin: 0; overflow: hidden; background: #f8fafc; font-family: sans-serif; }
        #root { height: 100%; display: flex; flex-direction: column; }
        .no-select { -webkit-user-select: none; user-select: none; }
        
        /* Anima√ß√£o do Microfone */
        @keyframes pulse-ring {
            0% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 20px rgba(59, 130, 246, 0); }
            100% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        .mic-active { animation: pulse-ring 2s infinite; }
    </style>
</head>
<body class="no-select text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // --- √çCONES SVG SEGUROS (N√£o travam o app) ---
        const Icons = {
            settings: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
            volume: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>,
            mic: <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>,
            keyboard: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="4" width="20" height="16" rx="2" ry="2"></rect><line x1="6" y1="8" x2="6" y2="8"></line><line x1="10" y1="8" x2="10" y2="8"></line><line x1="14" y1="8" x2="14" y2="8"></line><line x1="18" y1="8" x2="18" y2="8"></line><line x1="6" y1="12" x2="6" y2="12"></line><line x1="10" y1="12" x2="10" y2="12"></line><line x1="14" y1="12" x2="14" y2="12"></line><line x1="18" y1="12" x2="18" y2="12"></line><line x1="7" y1="16" x2="17" y2="16"></line></svg>,
            arrow: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>,
            refresh: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>,
            close: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        };

        const Icon = ({ name, className }) => <span className={`inline-flex items-center justify-center ${className}`}>{Icons[name]}</span>;

        // --- 2. DADOS INTELIGENTES ---
        const dictionary = {
            subjects: [
                { en: "I", pt: "Eu", pron: "ai", is3rd: false },
                { en: "You", pt: "Voc√™", pron: "i√∫", is3rd: false },
                { en: "He", pt: "Ele", pron: "r√≠", is3rd: true },
                { en: "She", pt: "Ela", pron: "x√≠", is3rd: true },
                { en: "We", pt: "N√≥s", pron: "u-√≠", is3rd: false },
                { en: "They", pt: "Eles", pron: "d√™i", is3rd: false }
            ],
            verbs: [
                { base: "like", pt: "gosto de", pron: "l√°ic", s: "likes", spt: "gosta de", spron: "l√°ics" },
                { base: "want", pt: "quero", pron: "u√¢nt", s: "wants", spt: "quer", spron: "u√¢nts" },
                { base: "need", pt: "preciso de", pron: "n√≠d", s: "needs", spt: "precisa de", spron: "n√≠dz" },
                { base: "have", pt: "tenho", pron: "r√©v", s: "has", spt: "tem", spron: "r√©s" }
            ],
            complements: [
                { en: "pizza", pt: "pizza", pron: "p√≠t-za" },
                { en: "coffee", pt: "caf√©", pron: "c√≥-fi" },
                { en: "water", pt: "√°gua", pron: "u√≥-ter" },
                { en: "money", pt: "dinheiro", pron: "m√¢-nei" }
            ]
        };

        const generateData = () => {
            const s = dictionary.subjects[Math.floor(Math.random() * dictionary.subjects.length)];
            const v = dictionary.verbs[Math.floor(Math.random() * dictionary.verbs.length)];
            const c = dictionary.complements[Math.floor(Math.random() * dictionary.complements.length)];
            
            let vEn = s.is3rd ? v.s : v.base;
            let vPt = s.is3rd ? v.spt : v.pt; 
            let vPron = s.is3rd ? v.spron : v.pron;
            
            if(s.en === "We" && v.pt.endsWith('o')) vPt = v.pt.slice(0,-1) + 'amos';
            if(s.en === "We" && v.base === 'have') vPt = 'temos';
            if(s.en === "They" && v.pt.endsWith('o')) vPt = v.pt.slice(0,-1) + 'am';
            if(s.en === "They" && v.base === 'have') vPt = 't√™m';

            return {
                pt: `${s.pt} ${vPt} ${c.pt}`,
                en: `${s.en} ${vEn} ${c.en}`,
                pron: `${s.pron} ${vPron} ${c.pron}`
            };
        };

        // --- 3. APP ---
        const App = () => {
            const [data, setData] = useState(generateData());
            const [status, setStatus] = useState('idle');
            const [feedback, setFeedback] = useState("");
            const [mode, setMode] = useState('voice'); // voice ou text
            const [transcript, setTranscript] = useState("");
            
            // Controle de Vozes
            const [voices, setVoices] = useState([]);
            const [selectedVoiceURI, setSelectedVoiceURI] = useState("");
            const [showSettings, setShowSettings] = useState(false);

            // Carregar Vozes ao Iniciar
            useEffect(() => {
                const load = () => {
                    const vs = window.speechSynthesis.getVoices().filter(v => v.lang.startsWith('en'));
                    setVoices(vs);
                    if (vs.length > 0 && !selectedVoiceURI) {
                        const saved = localStorage.getItem('voiceURI');
                        if (saved && vs.some(v => v.voiceURI === saved)) {
                            setSelectedVoiceURI(saved);
                        } else {
                            // Prefere Google ou a primeira
                            const best = vs.find(v => v.name.includes("Google") && v.lang === "en-US") || vs[0];
                            setSelectedVoiceURI(best.voiceURI);
                        }
                    }
                };
                load();
                if (window.speechSynthesis.onvoiceschanged !== undefined) {
                    window.speechSynthesis.onvoiceschanged = load;
                }
            }, []);

            const saveVoice = (uri) => {
                setSelectedVoiceURI(uri);
                localStorage.setItem('voiceURI', uri);
                speakPreview(uri); // Toca um "Hello" pra testar
            };

            const speakPreview = (uri) => {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance("Hello!");
                u.lang = 'en-US';
                const v = voices.find(vi => vi.voiceURI === uri);
                if(v) u.voice = v;
                window.speechSynthesis.speak(u);
            };

            const speak = () => {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(data.en);
                u.lang = 'en-US';
                u.rate = 0.8;
                if (selectedVoiceURI) {
                    const v = voices.find(vi => vi.voiceURI === selectedVoiceURI);
                    if(v) u.voice = v;
                }
                window.speechSynthesis.speak(u);
            };

            const next = () => {
                setData(generateData());
                setStatus('idle');
                setFeedback("");
                setTranscript("");
            };

            const listen = () => {
                const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SR) { setMode('text'); return alert("Sem suporte a voz. Use texto."); }

                try {
                    const rec = new SR();
                    rec.lang = 'en-US';
                    rec.onstart = () => setStatus('listening');
                    rec.onend = () => { if(status==='listening') setStatus('idle'); };
                    rec.onresult = (e) => {
                        const t = e.results[0][0].transcript;
                        setTranscript(t);
                        validate(t);
                    };
                    rec.start();
                } catch(e) {
                    setStatus('idle');
                }
            };

            const validate = (text) => {
                const cleanText = text.toLowerCase().replace(/[^a-z]/g, '');
                const cleanEn = data.en.toLowerCase().replace(/[^a-z]/g, '');
                if (cleanText.includes(cleanEn) || cleanEn.includes(cleanText)) {
                    setFeedback("MUITO BEM!");
                    speak();
                } else {
                    setFeedback("TENTE DE NOVO");
                }
            };

            return (
                <div className="flex flex-col h-full max-w-md mx-auto bg-slate-50 shadow-2xl relative">
                    
                    {/* Header com Bot√£o de Configura√ß√£o de Voz */}
                    <header className="bg-white p-3 shadow-sm shrink-0 flex justify-between items-center z-20 relative">
                        <h1 className="font-bold text-slate-700 text-lg">Tutor Lite</h1>
                        <div className="flex gap-2 items-center">
                            <button onClick={() => setShowSettings(!showSettings)} className="p-2 bg-slate-100 rounded-full text-slate-500 active:bg-slate-200">
                                <Icon name="settings" className="w-5 h-5" />
                            </button>
                            <span className="bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded">BR</span>
                        </div>
                    </header>

                    {/* Menu de Escolher Voz (Overlay) */}
                    {showSettings && (
                        <div className="absolute top-14 left-2 right-2 z-30 bg-white p-4 rounded-xl shadow-xl border border-slate-200 animate-in fade-in slide-in-from-top-2">
                            <div className="flex justify-between items-center mb-2">
                                <h3 className="font-bold text-slate-700">Escolha a Voz:</h3>
                                <button onClick={()=>setShowSettings(false)} className="p-1"><Icon name="close" className="w-5 h-5 text-slate-400"/></button>
                            </div>
                            <select 
                                className="w-full p-3 border rounded-lg bg-slate-50 text-sm mb-2"
                                value={selectedVoiceURI}
                                onChange={(e) => saveVoice(e.target.value)}
                            >
                                {voices.length === 0 && <option>Carregando vozes...</option>}
                                {voices.map(v => (
                                    <option key={v.voiceURI} value={v.voiceURI}>
                                        {v.name.replace('English', '').replace('(United States)', 'US')}
                                    </option>
                                ))}
                            </select>
                            <p className="text-xs text-slate-400 text-center">A voz selecionada ser√° salva.</p>
                        </div>
                    )}

                    <main className="flex-1 p-4 flex flex-col gap-4 overflow-hidden" onClick={() => setShowSettings(false)}>
                        
                        {/* Card Visual */}
                        <div className="bg-white p-5 rounded-3xl shadow border border-slate-100 relative flex flex-col gap-4 shrink-0">
                            <button onClick={next} className="absolute top-4 right-4 text-slate-300 p-1 hover:text-green-500 transition-colors">
                                <Icon name="refresh" className="w-4 h-4" />
                            </button>

                            <div className="flex items-center gap-3">
                                <span className="text-2xl filter drop-shadow-sm">üáßüá∑</span>
                                <span className="text-lg font-bold text-slate-800 leading-tight">{data.pt}</span>
                            </div>
                            <div className="flex items-center gap-3">
                                <span className="text-2xl filter drop-shadow-sm">üá∫üá∏</span>
                                <span className="text-lg font-bold text-yellow-500 leading-tight">{data.en}</span>
                            </div>
                            <div className="flex items-center gap-3">
                                <span className="text-2xl filter drop-shadow-sm">üó£Ô∏è</span>
                                <span className="text-lg font-bold text-orange-500 italic leading-tight">{data.pron}</span>
                            </div>
                        </div>

                        {/* Bot√£o Ouvir */}
                        <button onClick={speak} className="bg-indigo-50 text-indigo-600 font-bold py-4 rounded-xl flex items-center justify-center gap-2 border border-indigo-100 shrink-0 active:bg-indigo-100 shadow-sm">
                            <Icon name="volume" className="w-5 h-5" /> OUVIR
                        </button>

                        {/* √Årea Interativa H√≠brida */}
                        <div className="flex-1 flex flex-col justify-center items-center relative">
                            
                            {/* Se estiver no modo voz, mostra o Bot√£o Grande */}
                            {mode === 'voice' ? (
                                <div className="flex flex-col items-center gap-4">
                                    <button 
                                        onClick={listen}
                                        className={`w-24 h-24 rounded-full flex items-center justify-center text-white shadow-xl transition-all active:scale-95 border-4 border-white z-10
                                            ${status === 'listening' ? 'bg-red-500 scale-110' : 
                                              feedback === 'MUITO BEM!' ? 'bg-green-500' : 'bg-indigo-600'}`}
                                    >
                                        <Icon name="mic" className="w-10 h-10" />
                                    </button>
                                    <div className="text-xs font-bold text-slate-400 uppercase tracking-widest">
                                        {status === 'listening' ? "Ouvindo..." : "Toque para falar"}
                                    </div>
                                </div>
                            ) : (
                                /* Modo Texto */
                                <div className="w-full flex gap-2 animate-in fade-in slide-in-from-bottom-2">
                                    <input 
                                        className="flex-1 p-3 border-2 border-slate-200 rounded-xl outline-none focus:border-green-500 transition-colors" 
                                        value={transcript} 
                                        onChange={e=>setTranscript(e.target.value)} 
                                        placeholder="Escreva em ingl√™s..." 
                                        autoFocus
                                    />
                                    <button onClick={()=>validate(transcript)} className="bg-green-500 text-white px-5 rounded-xl font-bold active:bg-green-600">OK</button>
                                </div>
                            )}

                            {/* Feedback flutuante */}
                            {feedback && (
                                <div className={`absolute bottom-0 font-bold px-4 py-2 rounded-full shadow-sm animate-bounce ${feedback==='MUITO BEM!' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                                    {feedback}
                                </div>
                            )}
                        </div>

                        {/* Footer */}
                        <div className="flex gap-3 shrink-0 mt-auto pb-2">
                            <button 
                                onClick={() => setMode(m => m==='voice'?'text':'voice')} 
                                className={`p-4 border rounded-xl transition-colors ${mode==='text' ? 'bg-indigo-50 border-indigo-200 text-indigo-600' : 'bg-white border-slate-200 text-slate-400'}`}
                            >
                                <Icon name="keyboard" className="w-6 h-6" />
                            </button>
                            <button onClick={next} className="flex-1 bg-slate-900 text-white font-bold rounded-xl flex items-center justify-center gap-2 active:bg-black py-4 shadow-lg active:scale-[0.98] transition-all">
                                PR√ìXIMA <Icon name="arrow" className="w-5 h-5" />
                            </button>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>