<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tutor Mobile Fit</title>
    
    <!-- Bibliotecas -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@0.263.1"></script>
    
    <style>
        /* Garante que o app ocupe a altura real da tela mobile */
        body, html { height: 100%; overflow: hidden; overscroll-behavior: none; }
        #root { height: 100%; }
        /* Evita sele√ß√£o de texto acidental ao tocar r√°pido */
        .no-select { -webkit-user-select: none; user-select: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans no-select">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // --- Dicion√°rio Seguro ---
        const dictionary = {
            subjects: [
                { en: "I", pt: "Eu", pron: "ai", is3rd: false },
                { en: "You", pt: "Voc√™", pron: "i√∫", is3rd: false },
                { en: "He", pt: "Ele", pron: "r√≠", is3rd: true },
                { en: "She", pt: "Ela", pron: "x√≠", is3rd: true },
                { en: "We", pt: "N√≥s", pron: "u-√≠", is3rd: false },
                { en: "They", pt: "Eles", pron: "d√™i", is3rd: false }
            ],
            verbs: [
                { base: "like", pt: "gosto de", pron: "l√°ic", s: "likes", spt: "gosta de", spron: "l√°ics" },
                { base: "want", pt: "quero", pron: "u√¢nt", s: "wants", spt: "quer", spron: "u√¢nts" },
                { base: "need", pt: "preciso de", pron: "n√≠d", s: "needs", spt: "precisa de", spron: "n√≠dz" },
                { base: "have", pt: "tenho", pron: "r√©v", s: "has", spt: "tem", spron: "r√©s" }
            ],
            complements: [
                { en: "pizza", pt: "pizza", pron: "p√≠t-za" },
                { en: "coffee", pt: "caf√©", pron: "c√≥-fi" },
                { en: "water", pt: "√°gua", pron: "u√≥-ter" },
                { en: "money", pt: "dinheiro", pron: "m√¢-nei" }
            ]
        };

        const generateData = () => {
            const s = dictionary.subjects[Math.floor(Math.random() * dictionary.subjects.length)];
            const v = dictionary.verbs[Math.floor(Math.random() * dictionary.verbs.length)];
            const c = dictionary.complements[Math.floor(Math.random() * dictionary.complements.length)];
            
            // L√≥gica simples de conjuga√ß√£o visual
            let vEn = s.is3rd ? v.s : v.base;
            let vPt = s.is3rd ? v.spt : v.pt; 
            let vPron = s.is3rd ? v.spron : v.pron;
            
            // Ajustes plurais b√°sicos para PT
            if(s.en === "We" && v.pt.endsWith('o')) vPt = v.pt.slice(0,-1) + 'amos';
            if(s.en === "We" && v.base === 'have') vPt = 'temos';
            if(s.en === "They" && v.pt.endsWith('o')) vPt = v.pt.slice(0,-1) + 'am';
            if(s.en === "They" && v.base === 'have') vPt = 't√™m';

            return {
                pt: `${s.pt} ${vPt} ${c.pt}`,
                en: `${s.en} ${vEn} ${c.en}`,
                pron: `${s.pron} ${vPron} ${c.pron}`
            };
        };

        const Icon = ({ name, className }) => {
            const r = useRef(null);
            useEffect(() => {
                if(window.lucide && r.current) window.lucide.createIcons({
                    attrs: {class: className}, nameAttr: 'data-lucide', icons: {[name]: r.current}
                });
            }, [name]);
            return <i ref={r} data-lucide={name}></i>;
        };

        const App = () => {
            const [data, setData] = useState(generateData());
            const [status, setStatus] = useState('idle');
            const [feedback, setFeedback] = useState(null);
            const [mode, setMode] = useState('voice');
            const [transcript, setTranscript] = useState("");
            
            const next = () => {
                setData(generateData());
                setStatus('idle');
                setFeedback(null);
                setTranscript("");
            };

            const speak = () => {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(data.en);
                u.lang = 'en-US'; u.rate = 0.8;
                const v = window.speechSynthesis.getVoices().find(v=>v.lang==='en-US' && v.name.includes('Google')) || window.speechSynthesis.getVoices().find(v=>v.lang==='en-US');
                if(v) u.voice = v;
                window.speechSynthesis.speak(u);
            };

            const listen = () => {
                const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
                if(!SR) { setMode('text'); return alert("Use modo texto"); }
                try {
                    const rec = new SR();
                    rec.lang = 'en-US';
                    rec.onstart = () => setStatus('listening');
                    rec.onend = () => { if(status==='listening') setStatus('idle'); };
                    rec.onresult = (e) => {
                        const t = e.results[0][0].transcript;
                        setTranscript(t);
                        validate(t);
                    };
                    rec.start();
                } catch(e) { setStatus('idle'); }
            };

            const validate = (t) => {
                const cleanT = t.toLowerCase().replace(/[^a-z]/g, '');
                const cleanEn = data.en.toLowerCase().replace(/[^a-z]/g, '');
                if(cleanT.includes(cleanEn) || cleanEn.includes(cleanT)) {
                    setFeedback('correct'); speak();
                } else {
                    setFeedback('incorrect');
                }
            };

            return (
                // h-[100dvh] garante altura total din√¢mica no mobile
                <div className="h-[100dvh] flex flex-col bg-slate-50 max-w-md mx-auto shadow-2xl overflow-hidden">
                    
                    {/* Header Compacto */}
                    <header className="bg-white p-3 flex justify-between items-center shadow-sm shrink-0 z-10">
                        <span className="font-bold text-slate-700">Tutor Visual</span>
                        <div className="bg-green-100 text-green-800 px-2 py-0.5 rounded text-xs font-bold">BR Edition</div>
                    </header>

                    {/* Conte√∫do Principal Flex√≠vel */}
                    <main className="flex-1 flex flex-col p-3 gap-3 overflow-hidden">
                        
                        {/* Card: Reduzi padding (p-4) para ganhar espa√ßo */}
                        <div className="bg-white rounded-2xl shadow border border-slate-100 p-4 flex flex-col gap-3 relative shrink-0">
                            
                            <button onClick={next} className="absolute top-3 right-3 text-slate-300 p-1">
                                <Icon name="refresh-cw" className="w-4 h-4" />
                            </button>

                            {/* Linhas de Texto Compactas */}
                            <div className="flex items-center gap-3">
                                <span className="text-xl">üáßüá∑</span>
                                <span className="text-lg font-bold text-slate-800 leading-tight">{data.pt}</span>
                            </div>
                            <div className="flex items-center gap-3">
                                <span className="text-xl">üá∫üá∏</span>
                                <span className="text-lg font-bold text-yellow-500 leading-tight">{data.en}</span>
                            </div>
                            <div className="flex items-center gap-3">
                                <span className="text-xl">üó£Ô∏è</span>
                                <span className="text-lg font-bold text-orange-500 italic leading-tight">{data.pron}</span>
                            </div>
                        </div>

                        {/* Bot√£o Ouvir Compacto */}
                        <button onClick={speak} className="bg-indigo-50 text-indigo-600 font-bold py-3 rounded-xl flex items-center justify-center gap-2 active:bg-indigo-100 shrink-0">
                            <Icon name="volume-2" className="w-5 h-5" /> OUVIR
                        </button>

                        {/* √Årea Microfone (Flex√≠vel) - Ocupa o espa√ßo que sobra, mas centralizado */}
                        <div className="flex-1 flex flex-col justify-center items-center min-h-0">
                            {mode === 'voice' ? (
                                <div className="relative">
                                    {status === 'listening' && <div className="absolute inset-0 bg-green-400 rounded-full animate-ping opacity-30"></div>}
                                    <button 
                                        onClick={listen}
                                        className={`w-20 h-20 rounded-full flex items-center justify-center text-white shadow-xl transition-all active:scale-95 relative z-10
                                            ${status === 'listening' ? 'bg-red-500 scale-110' : 
                                              feedback === 'correct' ? 'bg-green-500' : 'bg-indigo-600'}`}
                                    >
                                        <Icon name="mic" className="w-9 h-9" />
                                    </button>
                                </div>
                            ) : (
                                <div className="w-full flex gap-2">
                                    <input className="flex-1 p-2 border rounded-lg" value={transcript} onChange={e=>setTranscript(e.target.value)} placeholder="Digite..." />
                                    <button onClick={()=>validate(transcript)} className="bg-green-500 text-white px-3 rounded-lg">OK</button>
                                </div>
                            )}

                            <div className="h-6 mt-2 text-center">
                                {feedback ? (
                                    <span className={`font-bold text-sm ${feedback==='correct'?'text-green-600':'text-red-500'}`}>
                                        {feedback === 'correct' ? "MUITO BEM!" : "TENTE DE NOVO"}
                                    </span>
                                ) : (
                                    <span className="text-xs font-bold text-slate-400 uppercase tracking-widest">
                                        {status === 'listening' ? "Ouvindo..." : "Toque para falar"}
                                    </span>
                                )}
                            </div>
                        </div>

                        {/* Rodap√© Fixo na base do flex */}
                        <div className="flex gap-3 shrink-0 mt-auto pb-1">
                            <button onClick={()=>setMode(m=>m==='voice'?'text':'voice')} className="p-3 bg-white border border-slate-200 rounded-xl text-slate-500">
                                <Icon name="keyboard" className="w-6 h-6" />
                            </button>
                            <button onClick={next} className="flex-1 bg-slate-800 text-white font-bold py-3 rounded-xl flex justify-center items-center gap-2 shadow-lg active:scale-95">
                                PR√ìXIMA <Icon name="arrow-right" className="w-5 h-5" />
                            </button>
                        </div>

                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

